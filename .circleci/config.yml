version: 2.1

# orbs:
#   maven: circleci/maven@0.0.12

# workflows:
#  maven_test:
#    jobs:
#      - maven/test # checkout, build, test, and upload test results

jobs:
  build:

    docker:
      - image: maven:latest 
      - image: redis:latest
    steps:
      - checkout
      - run:
        name: Waiting for Postgres to be ready
        command: |
          for i in `seq 1 10`;
          do
            nc -z localhost 6379 && echo Success && exit 0
            echo -n .
            sleep 1
          done
          echo Failed waiting for Postgres && exit 1
      - run:
          name: clean
          command: mvn clean
      - run:
          name: install
          command: mvn install
      - run: 
          name: test  
          command: mvn test